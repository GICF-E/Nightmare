# FPS-Demo文档
## 项目概述
这是一个简单的基于Low Poly风格模型实现的恐怖FPS游戏，提供了可拾取的数款枪械并设计了射击和敌人系统。  
**注意：** FPS-Demo仅供学习参考使用，可能缺乏一定娱乐性及趣味性，不用于商业用途。  
目前该项目持续开发中，当前版本仅为初期概念演示。

## 操作介绍
### 观察者模式
观察者模式中移动使用WASD进行平面移动，通过鼠标移动视角（上下视角有最大角度限制）。其中，WASD的移动只会受到鼠标左右视角移动所受到的旋转影响，即WASD永远只能实现平面移动，不能进行Y轴移动。可以使用以下按键对观察者摄像机进行操作：
   - 使用[Space]键对Y轴进行正移动
   - 使用[Control]键实现Y轴负移动
**注：**观察者摄像机不存在碰撞题且不受重力影响，不会受到场景碰撞题的影响。
### 角色移动
FPS-Demo通过经典的WASD来平面移动，通过以下按键来对玩家执行操作：
   - 通过[SPACE]键完成跳跃
   - 通过[LeftShift]键实现奔跑以增加速度
   - 通过[Control]按键实现下蹲以降低移动声音并减小速度
### 武器操作
FPS-Demo的所有武器使用统一的操作逻辑。通过鼠标左键实现射击，对于全自动武器，按住鼠标左键可以连续射击。FPS-Demo的开镜由鼠标右键的点击完成，单击一次开镜，再次单击关镜。可以通过以下按键操控武器：
   - 按 [I] 键进行检视
   - 按 [R] 键进行换弹
   - 按 [C] 键可以切换手电筒的开闭状态
   - 按 [Q] 可以发动近战
   - 按[X]键更换射击模式（仅对全自动武器有效）
### 武器库操作
FPS-Demo中武器库存在武器的上限为3，即当武器空中已有3把武器后将不能在拾取武器。武器库通过鼠标滚轮或数字键盘来判定武器的更改武器，其中，当使用鼠标滚轮切换武器并已是最后一把武器时，再次向下滚动鼠标滚轮讲切换到第1把武器，而使用数字键盘切换武器时若输入为0或超出武器库中武器的数量，将切换到空手状态。如果想要拾取武器，只需要移动到武器所在的位置，武器将被自动拾起并切换到当前武器。按下[T]键可以丢弃武器，武器将被丢弃在玩家正前方，可以重新拾取。
### 攻击敌人
FPS-Demo中可以用武器和场景中的可交互物体对敌人进行攻击。使用枪械对敌人造成伤害的判定使用基于物理的Raycast，不同型号和种类的枪械对于敌人造成的伤害不同。同样的，场景中的大部分可交互物体，如油桶和气瓶，也可以对敌人造成伤害，使用子弹或近战可使其爆炸，不同种类的物体对敌人造成的伤害和伤害的范围各不相同。对于场景中的可交互物体，内容详见/场景/可交互物体/。

## 枪械实现
### 枪械渲染
FPS-Demo中的所有枪械都与场景分开渲染，将GunCamera渲染的Player层深度视图叠加到MainCamera上。因此，FPS-Demo中的所有枪械不可能与场景中的物体发生穿模现象。
### 射击判定
FPS-Demo同时使用了两套系统进行判定，对于击中敌人和扣血的判定，使用从枪口发射的Physics.Raycast(射线检测)，而对于弹孔和场景中可交互物体（如油桶、气瓶）及弹孔的生成，使用了基于物理Rigidbody的真实子弹，对子弹施加初始速度，以基于几何节点的碰撞起判定碰撞。
### 枪械换弹
对于所有的步枪、手枪和部份有弹夹的狙击枪换单子弹会在插入弹夹时被瞬间增加。对于所有的霰弹枪和部份狙击枪，换单时子弹的增加会依据动画状态机中动画的执行，即真实的子弹数会根据一颗一颗填入子弹的动画而自然地增加。
### 开镜镜内放大效果的实现
FPS-Demo中所有狙击枪的镜内放大效果都使用了一个专门的低FOV像机将图像映射到空间中狙击镜的前部，已实现开镜效果。狙击镜在开镜和关镜状态下会前玻璃会呈现出不同的颜色以模拟真实的效果。
### 武器的丢弃与拾取
FPS-Demo中为枪械模型添加Trigger碰撞箱以使枪械能够自动地被拾取。丢弃武器时该项目采用直接生成的方式，用基于物理的MeshCollider及RigidBody使枪械物体自然地落到地上。

## 敌人实现
### 敌人概述
FPS-Demo中暂时只有两种敌人，'Zombie'「丧失」和'Mutant'「变种人」。变种人无论是血量、速度、伤害等方面都远远强于丧失，因此理论上来说，丧失通常会在变种人的带领下扎堆活动。通常地来说，敌人应当在没有发现玩家时以行走速度执行巡逻，发现玩家后向玩家奔跑。当然，也不乏丧失或变种人单独出现活动甚至不巡逻的情况。
### 敌人发现玩家的判定
敌人只有在满足一定条件下才会发现玩家，具体情况如下:
```c#
// 伪代码
if(玩家进入敌人的可发现范围){
    if(玩家不在下蹲&&玩家正在移动) 敌人发现玩家;
    if(玩家使用了不带有消音器的枪械开枪) 敌人发现玩家;
    if(玩家达到了敌人的绝对发现阈值) 敌人发现玩家；
}else{
    敌人不会发现玩家；
}
```
**注：** 不同敌人的可发现范围和绝对发现阈值不同。
### 敌人的攻击
敌人会在进入攻击范围后停止并执行攻击程序，不同种类的敌人的攻击伤害和CD不同。对于丧失，敌人会有较短的CD和较小的伤害；对于变种人，敌人会有较长的CD和极大的伤害，变种人攻击时有爆炸例子特效。玩家在敌人的攻击范围内并且敌人在执行CD冷却时会执行Idle动画。

## 场景
### 可交互物体
FPS-Demo场景中只有油桶和气瓶可以与子弹和玩家交互。油桶和气瓶可以被玩家推动，可交互物体的爆炸判定有物理发射的子弹执行。其中，当子弹碰撞到油桶时，油桶会瞬间爆炸并在大范围内释放出大量伤害；当子弹碰撞到气瓶时，气瓶会从顶部漏气，内部压力达到一个阈值时就会产生爆炸，在一个相对小的范围内释放出一定伤害。  
**注：** 场景中的可交互物体的破坏不会影响地形。
### 特殊场景
FPS-Demo中的一些特定场景会对玩家造成一定的影响。例如，水中玩家会被强行下蹲，不能跳跃并在移动的时候播放水中移动的音效。对于场景中所有通过玩家进入且此时天花板的高度小于玩家站立高度的情况，玩家会被强制下蹲，即使用户松开[Control]，离开该场景且用户没有按下[Control]的情况中，玩家会自动重新进入站立状态。