# FPS-Demo中文文档
## 项目概述
这是一个简单的基于Low Poly风格模型实现的恐怖FPS游戏，提供了可拾取的数款枪械并设计了射击和敌人系统，基于`C#`语言和`Unity3D Build-In`渲染管线制作。  
  
**注意：FPS-Demo仅供学习参考使用，可能缺乏一定娱乐性及趣味性，不用于商业用途。我们不对项目的稳定性和最终效果负有任何责任。**  

## 目录
如果您只想对项目进行简单体验，可以查看第一部份和第二部份，无需了解其原理。如果您正在学习C#或Unity，我们建议阅读我们全部的文档，熟悉FPS-Demo的运作逻辑和机制，以便参考和借鉴。
#### 第一部份 - [下载和使用](#section1)
#### 第二部份 - [操作模式](#section2)
#### 第三部份 - [枪械实现](#section3)
#### 第四部份 - [敌人实现](#section4)
#### 第五部份 - [场景](#section5)

<h2 id="section1">下载和使用</h2>

### 下载
一般情况下，我们推荐用户直接前往`Releases`界面下载与操纵版本对应的已打包的游戏程序，而不是在`Code - DownloadZip`中直接下载源代码。

### 启动
FPS-Demo在不同在操作系统下有不同的安装方式，请您在下载对应架构的软件后执行下列操作：  
#### MacOS
如果您使用的是MacOS操作系统，您可以直接将下载下的软件移动至`访达-边栏-应用程序`或`Users/(您的用户名)/Application`。不出意外的话，您将在启动台中看到它，单击鼠标左键可以打开，点击游戏内`Ese - 退出游戏`或在任意界面按下`[LeftCommand] + [Q]`可以强制退出游戏。  
#### Windows
如果您使用的是Windows操作系统，不出意外，您将获得一个文件夹。如果您想直接启动程序，可以进入文件夹并直接打开`FPS-Demo.exe`。为了要获得更好的开启体验，可以将文件夹手动移动至默认下载文件夹或自定义路径，即`C:\Program Files\`，并添加快捷方式至桌面。  

<h2 id="section2">操作模式</h2>

### 观察者模式
观察者模式中移动使用`WASD`进行平面移动，通过鼠标移动视角（上下视角有最大角度限制）。其中，WASD的移动只会受到鼠标左右视角移动所受到的旋转影响，即`WASD`永远只能实现平面移动，不能进行Y轴移动。可以使用以下按键对观察者摄像机进行操作：
   - 使用`[E]`键对Y轴进行正移动
   - 使用`[Q]`键实现Y轴负移动  

***注： 观察者摄像机不存在碰撞题且不受重力影响，不会受到场景碰撞题的影响。**

### 角色移动
FPS-Demo通过经典的WASD来平面移动，通过以下按键来对玩家执行操作：
   - 通过`[SPACE]`键完成跳跃
   - 通过`[LeftShift]`键实现奔跑以增加速度
   - 通过`[Control]`按键实现下蹲以降低移动声音并减小速度

### 武器操作
FPS-Demo的所有武器使用统一的操作逻辑。通过鼠标左键实现射击，对于全自动武器，按住鼠标左键可以连续射击。FPS-Demo的开镜由鼠标右键的点击完成，单击一次开镜，再次单击关镜。可以通过以下按键操控武器：
   - 按 `[I]` 键进行检视
   - 按 `[R]` 键进行换弹
   - 按 `[C]` 键可以切换手电筒的开闭状态
   - 按 `[Q]` 可以发动近战
   - 按 `[X]` 键更换射击模式（仅对全自动武器有效）

### 武器的更换
FPS-Demo中武器库通过鼠标滚轮或数字键盘来判定武器的更改武器。如果使用鼠标滚轮，您可以通过向下/向上滑动切换至下一把/上一把武器，如果已经是最后一把武器，下一次滑动将会切换到空手状态，再次滑动会切换到第一把武器。同理的，如果使用数字键盘，可以通过按下按键可以直接切换到对应编号的武器，若输入超限或为0，即输入的数字不为已有的任何一把武器的编号，将切换到空手状态。空手状态不能发动近战。

### 物体的丢弃和拾取
在FPS-Demo中，如果您想要拾取武器或者可交互物体，您需要将玩家移动到物体附近，并将视角移动到您想要拾取/交互物体上。如果该物体可以被交互，您会看到该物体的上方出现了一个半透明的圆形，此时即代表您可以进行拾取操作。对于枪械，如果您原先没有这把武器，拾取后会自动切换到对应武器，如果您已经拥有这把武器，那么再次进行拾取将会自动补满对应武器的备弹并切换到当前武器。如果您想要丢弃物体，您需要切换到希望丢弃的枪械并按下丢弃键，物体会自动生成在您的前方并自然下落。您可以通过以下按键对物体进行交互：
   - 按 `[F]` 键拾取/交互物体
   - 按 `[T]` 键丢弃物体
  
***注：武器库的拾取上限为3，即如果您已经拥有3把武器，您将不能够再拾取新的武器。**

### 攻击敌人
FPS-Demo中可以用武器和场景中的可交互物体对敌人进行攻击。使用枪械对敌人造成伤害的判定使用基于物理的Raycast，不同型号和种类的枪械对于敌人造成的伤害不同。同样的，场景中的大部分可交互物体，如油桶和气瓶，也可以对敌人造成伤害，使用子弹或近战可使其爆炸，不同种类的物体对敌人造成的伤害和伤害的范围各不相同。对于场景中的可交互物体，内容详见`/场景 - 可交互物体/`。 

<h2 id="section3">枪械实现</h2>

### 枪械渲染
FPS-Demo中的所有枪械都与场景分开渲染，将GunCamera渲染的Player层深度视图叠加到MainCamera上。因此，FPS-Demo中的所有枪械不可能与场景中的物体发生穿模现象。  

### 射击判定
FPS-Demo同时使用了两套系统进行判定，对于击中敌人和扣血的判定，使用从枪口发射的Physics.Raycast(射线检测)，而对于弹孔和场景中可交互物体（如油桶、气瓶）及弹孔的生成，使用了基于物理Rigidbody的真实子弹，对子弹施加初始速度，以基于几何节点的碰撞起判定碰撞。

### 枪械换弹
对于所有的步枪、手枪和部份有弹夹的狙击枪换单子弹会在插入弹夹时被瞬间增加。对于所有的霰弹枪和部份狙击枪，换单时子弹的增加会依据动画状态机中动画的执行，即真实的子弹数会根据一颗一颗填入子弹的动画而自然地增加。  

### 镜内放大效果的实现
FPS-Demo中所有狙击枪的镜内放大效果都使用了一个专门的低FOV像机将图像映射到空间中狙击镜的前部，已实现开镜效果。狙击镜在开镜和关镜状态下会前玻璃会呈现出不同的颜色以模拟真实的效果。  

### 枪械的丢弃与拾取
FPS-Demo中为交互物体挂载了基于几何节点的Trigger碰撞箱，同时通过为玩家的摄像机加入带有特殊Tag的碰撞箱作为子物体，使交互物体可以判断玩家的视角是否朝向物体。如果玩家摄像机下的碰撞箱碰撞到交互物体，该物体会将隐藏的圆形2D图像启用。由于玩家和物体可能处于不同的旋转角度，UI图像会保持在离玩家最近的垂直方向，且始终朝向玩家。等待玩家按下对应按键并执行对应操作。丢弃武器时该项目采用直接生成的方式，用基于物理的MeshCollider及RigidBody使枪械物体受重力自然地落到地上。  

<h2 id="section4">敌人实现</h2>

### 敌人概述
FPS-Demo中暂时只有两种敌人，「丧失」和「变种人」。变种人无论是血量、速度、伤害等方面都远远强于丧失，因此理论上来说，丧失通常会在变种人的带领下扎堆活动。通常地来说，敌人应当在没有发现玩家时以行走速度执行巡逻，发现玩家后向玩家奔跑。当然，也不乏丧失或变种人单独出现活动甚至不巡逻的情况。

### 敌人发现玩家的判定
敌人只有在满足一定条件下才会发现玩家，具体情况如下:
```c#
// 伪代码
if(玩家进入敌人的可发现范围){
    if(玩家不在下蹲&&玩家正在移动) 敌人发现玩家;
    if(玩家使用了不带有消音器的枪械开枪) 敌人发现玩家;
    if(玩家达到了敌人的绝对发现阈值) 敌人发现玩家；
}else{
    敌人不会发现玩家；
}
```
***注：不同敌人的可发现范围和绝对发现阈值不同。**

### 敌人的攻击
敌人会在进入攻击范围后停止并执行攻击程序，不同种类的敌人的攻击伤害和CD不同。对于丧失，敌人会有较短的CD和较小的伤害；对于变种人，敌人会有较长的CD和极大的伤害，变种人攻击时有爆炸例子特效。玩家在敌人的攻击范围内并且敌人在执行CD冷却时会执行Idle动画。  

<h2 id="section5">场景 Scenes</h2>

### 可交互物体
FPS-Demo场景中只有油桶和气瓶可以与子弹和玩家交互。油桶和气瓶可以被玩家推动，可交互物体的爆炸判定有物理发射的子弹执行。其中，当子弹碰撞到油桶时，油桶会瞬间爆炸并在大范围内释放出大量伤害；当子弹碰撞到气瓶时，气瓶会从顶部漏气，内部压力达到一个阈值时就会产生爆炸，在一个相对小的范围内释放出一定伤害。 
***注：场景中的可交互物体的破坏不会影响地形。**

### 特殊场景
FPS-Demo中的一些特定场景会对玩家造成一定的影响。例如，水中玩家会被强行下蹲，不能跳跃并在移动的时候播放水中移动的音效。对于场景中所有通过玩家进入且此时天花板的高度小于玩家站立高度的情况，玩家会被强制下蹲，即使用户松开 `[Control]`，离开该场景且用户没有按下 `[Control]` 的情况中，玩家会自动重新进入站立状态。  